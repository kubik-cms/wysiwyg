(function(p,c){typeof exports=="object"&&typeof module!="undefined"?module.exports=c():typeof define=="function"&&define.amd?define(c):(p=typeof globalThis!="undefined"?globalThis:p||self,p.wysiwyg=c())})(this,function(){"use strict";function p(t){return t.replace(/(?:[_-])([a-z0-9])/g,(e,r)=>r.toUpperCase())}function c(t){return t.charAt(0).toUpperCase()+t.slice(1)}function ct(t){return t.replace(/([A-Z])/g,(e,r)=>`-${r.toLowerCase()}`)}function E(t,e){const r=R(t);return Array.from(r.reduce((a,s)=>(ht(s,e).forEach(n=>a.add(n)),a),new Set))}function lt(t,e){return R(t).reduce((a,s)=>(a.push(...dt(s,e)),a),[])}function R(t){const e=[];for(;t;)e.push(t),t=Object.getPrototypeOf(t);return e.reverse()}function ht(t,e){const r=t[e];return Array.isArray(r)?r:[]}function dt(t,e){const r=t[e];return r?Object.keys(r).map(a=>[a,r[a]]):[]}(()=>{function t(r){function a(){return Reflect.construct(r,arguments,new.target)}return a.prototype=Object.create(r.prototype,{constructor:{value:a}}),Reflect.setPrototypeOf(a,r),a}function e(){const a=t(function(){this.a.call(this)});return a.prototype.a=function(){},new a}try{return e(),t}catch{return a=>class extends a{}}})();function ft(t){return E(t,"classes").reduce((r,a)=>Object.assign(r,pt(a)),{})}function pt(t){return{[`${t}Class`]:{get(){const{classes:e}=this;if(e.has(t))return e.get(t);{const r=e.getAttributeName(t);throw new Error(`Missing attribute "${r}"`)}}},[`${t}Classes`]:{get(){return this.classes.getAll(t)}},[`has${c(t)}Class`]:{get(){return this.classes.has(t)}}}}function gt(t){return E(t,"targets").reduce((r,a)=>Object.assign(r,vt(a)),{})}function vt(t){return{[`${t}Target`]:{get(){const e=this.targets.find(t);if(e)return e;throw new Error(`Missing target element "${t}" for "${this.identifier}" controller`)}},[`${t}Targets`]:{get(){return this.targets.findAll(t)}},[`has${c(t)}Target`]:{get(){return this.targets.has(t)}}}}function mt(t){const e=lt(t,"values"),r={valueDescriptorMap:{get(){return e.reduce((a,s)=>{const n=M(s,this.identifier),o=this.data.getAttributeNameForKey(n.key);return Object.assign(a,{[o]:n})},{})}}};return e.reduce((a,s)=>Object.assign(a,bt(s)),r)}function bt(t,e){const r=M(t,e),{key:a,name:s,reader:n,writer:o}=r;return{[s]:{get(){const i=this.data.get(a);return i!==null?n(i):r.defaultValue},set(i){i===void 0?this.data.delete(a):this.data.set(a,o(i))}},[`has${c(s)}`]:{get(){return this.data.has(a)||r.hasCustomDefaultValue}}}}function M([t,e],r){return wt({controller:r,token:t,typeDefinition:e})}function T(t){switch(t){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function g(t){switch(typeof t){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}if(Array.isArray(t))return"array";if(Object.prototype.toString.call(t)==="[object Object]")return"object"}function _t(t){const e=T(t.typeObject.type);if(!e)return;const r=g(t.typeObject.default);if(e!==r){const a=t.controller?`${t.controller}.${t.token}`:t.token;throw new Error(`The specified default value for the Stimulus Value "${a}" must match the defined type "${e}". The provided default value of "${t.typeObject.default}" is of type "${r}".`)}return e}function yt(t){const e=_t({controller:t.controller,token:t.token,typeObject:t.typeDefinition}),r=g(t.typeDefinition),a=T(t.typeDefinition),s=e||r||a;if(s)return s;const n=t.controller?`${t.controller}.${t.typeDefinition}`:t.token;throw new Error(`Unknown value type "${n}" for "${t.token}" value`)}function $t(t){const e=T(t);if(e)return Ot[e];const r=t.default;return r!==void 0?r:t}function wt(t){const e=`${ct(t.token)}-value`,r=yt(t);return{type:r,key:e,name:p(e),get defaultValue(){return $t(t.typeDefinition)},get hasCustomDefaultValue(){return g(t.typeDefinition)!==void 0},reader:Tt[r],writer:F[r]||F.default}}const Ot={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},Tt={array(t){const e=JSON.parse(t);if(!Array.isArray(e))throw new TypeError(`expected value of type "array" but instead got value "${t}" of type "${g(e)}"`);return e},boolean(t){return!(t=="0"||String(t).toLowerCase()=="false")},number(t){return Number(t)},object(t){const e=JSON.parse(t);if(e===null||typeof e!="object"||Array.isArray(e))throw new TypeError(`expected value of type "object" but instead got value "${t}" of type "${g(e)}"`);return e},string(t){return t}},F={default:Ct,array:H,object:H};function H(t){return JSON.stringify(t)}function Ct(t){return`${t}`}class l{constructor(e){this.context=e}static get shouldLoad(){return!0}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(e,{target:r=this.element,detail:a={},prefix:s=this.identifier,bubbles:n=!0,cancelable:o=!0}={}){const i=s?`${s}:${e}`:e,u=new CustomEvent(i,{detail:a,bubbles:n,cancelable:o});return r.dispatchEvent(u),u}}l.blessings=[ft,gt,mt],l.targets=[],l.values={};var b=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},jt=typeof b=="object"&&b&&b.Object===Object&&b,St=jt,Vt=St,At=typeof self=="object"&&self&&self.Object===Object&&self,Dt=Vt||At||Function("return this")(),C=Dt,Pt=C,Nt=Pt.Symbol,j=Nt,z=j,G=Object.prototype,It=G.hasOwnProperty,xt=G.toString,v=z?z.toStringTag:void 0;function Lt(t){var e=It.call(t,v),r=t[v];try{t[v]=void 0;var a=!0}catch{}var s=xt.call(t);return a&&(e?t[v]=r:delete t[v]),s}var kt=Lt,Et=Object.prototype,Rt=Et.toString;function Mt(t){return Rt.call(t)}var Ft=Mt,K=j,Ht=kt,zt=Ft,Gt="[object Null]",Kt="[object Undefined]",U=K?K.toStringTag:void 0;function Ut(t){return t==null?t===void 0?Kt:Gt:U&&U in Object(t)?Ht(t):zt(t)}var W=Ut;function Wt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var S=Wt,Jt=W,qt=S,Bt="[object AsyncFunction]",Xt="[object Function]",Zt="[object GeneratorFunction]",Yt="[object Proxy]";function Qt(t){if(!qt(t))return!1;var e=Jt(t);return e==Xt||e==Zt||e==Bt||e==Yt}var te=Qt,ee=C,re=ee["__core-js_shared__"],ae=re,V=ae,J=function(){var t=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function se(t){return!!J&&J in t}var ne=se,ie=Function.prototype,oe=ie.toString;function ue(t){if(t!=null){try{return oe.call(t)}catch{}try{return t+""}catch{}}return""}var ce=ue,le=te,he=ne,de=S,fe=ce,pe=/[\\^$.*+?()[\]{}|]/g,ge=/^\[object .+?Constructor\]$/,ve=Function.prototype,me=Object.prototype,be=ve.toString,_e=me.hasOwnProperty,ye=RegExp("^"+be.call(_e).replace(pe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function $e(t){if(!de(t)||he(t))return!1;var e=le(t)?ye:ge;return e.test(fe(t))}var we=$e;function Oe(t,e){return t==null?void 0:t[e]}var Te=Oe,Ce=we,je=Te;function Se(t,e){var r=je(t,e);return Ce(r)?r:void 0}var A=Se,Ve=A,Ae=function(){try{var t=Ve(Object,"defineProperty");return t({},"",{}),t}catch{}}(),De=Ae,q=De;function Pe(t,e,r){e=="__proto__"&&q?q(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var Ne=Pe;function Ie(t,e){return t===e||t!==t&&e!==e}var B=Ie,xe=Ne,Le=B,ke=Object.prototype,Ee=ke.hasOwnProperty;function Re(t,e,r){var a=t[e];(!(Ee.call(t,e)&&Le(a,r))||r===void 0&&!(e in t))&&xe(t,e,r)}var Me=Re,Fe=Array.isArray,D=Fe;function He(t){return t!=null&&typeof t=="object"}var ze=He,Ge=W,Ke=ze,Ue="[object Symbol]";function We(t){return typeof t=="symbol"||Ke(t)&&Ge(t)==Ue}var P=We,Je=D,qe=P,Be=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Xe=/^\w*$/;function Ze(t,e){if(Je(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||qe(t)?!0:Xe.test(t)||!Be.test(t)||e!=null&&t in Object(e)}var Ye=Ze,Qe=A,tr=Qe(Object,"create"),_=tr,X=_;function er(){this.__data__=X?X(null):{},this.size=0}var rr=er;function ar(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var sr=ar,nr=_,ir="__lodash_hash_undefined__",or=Object.prototype,ur=or.hasOwnProperty;function cr(t){var e=this.__data__;if(nr){var r=e[t];return r===ir?void 0:r}return ur.call(e,t)?e[t]:void 0}var lr=cr,hr=_,dr=Object.prototype,fr=dr.hasOwnProperty;function pr(t){var e=this.__data__;return hr?e[t]!==void 0:fr.call(e,t)}var gr=pr,vr=_,mr="__lodash_hash_undefined__";function br(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=vr&&e===void 0?mr:e,this}var _r=br,yr=rr,$r=sr,wr=lr,Or=gr,Tr=_r;function h(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}h.prototype.clear=yr,h.prototype.delete=$r,h.prototype.get=wr,h.prototype.has=Or,h.prototype.set=Tr;var Cr=h;function jr(){this.__data__=[],this.size=0}var Sr=jr,Vr=B;function Ar(t,e){for(var r=t.length;r--;)if(Vr(t[r][0],e))return r;return-1}var y=Ar,Dr=y,Pr=Array.prototype,Nr=Pr.splice;function Ir(t){var e=this.__data__,r=Dr(e,t);if(r<0)return!1;var a=e.length-1;return r==a?e.pop():Nr.call(e,r,1),--this.size,!0}var xr=Ir,Lr=y;function kr(t){var e=this.__data__,r=Lr(e,t);return r<0?void 0:e[r][1]}var Er=kr,Rr=y;function Mr(t){return Rr(this.__data__,t)>-1}var Fr=Mr,Hr=y;function zr(t,e){var r=this.__data__,a=Hr(r,t);return a<0?(++this.size,r.push([t,e])):r[a][1]=e,this}var Gr=zr,Kr=Sr,Ur=xr,Wr=Er,Jr=Fr,qr=Gr;function d(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}d.prototype.clear=Kr,d.prototype.delete=Ur,d.prototype.get=Wr,d.prototype.has=Jr,d.prototype.set=qr;var Br=d,Xr=A,Zr=C,Yr=Xr(Zr,"Map"),Qr=Yr,Z=Cr,ta=Br,ea=Qr;function ra(){this.size=0,this.__data__={hash:new Z,map:new(ea||ta),string:new Z}}var aa=ra;function sa(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var na=sa,ia=na;function oa(t,e){var r=t.__data__;return ia(e)?r[typeof e=="string"?"string":"hash"]:r.map}var $=oa,ua=$;function ca(t){var e=ua(this,t).delete(t);return this.size-=e?1:0,e}var la=ca,ha=$;function da(t){return ha(this,t).get(t)}var fa=da,pa=$;function ga(t){return pa(this,t).has(t)}var va=ga,ma=$;function ba(t,e){var r=ma(this,t),a=r.size;return r.set(t,e),this.size+=r.size==a?0:1,this}var _a=ba,ya=aa,$a=la,wa=fa,Oa=va,Ta=_a;function f(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}f.prototype.clear=ya,f.prototype.delete=$a,f.prototype.get=wa,f.prototype.has=Oa,f.prototype.set=Ta;var Ca=f,Y=Ca,ja="Expected a function";function N(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(ja);var r=function(){var a=arguments,s=e?e.apply(this,a):a[0],n=r.cache;if(n.has(s))return n.get(s);var o=t.apply(this,a);return r.cache=n.set(s,o)||n,o};return r.cache=new(N.Cache||Y),r}N.Cache=Y;var Sa=N,Va=Sa,Aa=500;function Da(t){var e=Va(t,function(a){return r.size===Aa&&r.clear(),a}),r=e.cache;return e}var Pa=Da,Na=Pa,Ia=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,xa=/\\(\\)?/g,La=Na(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Ia,function(r,a,s,n){e.push(s?n.replace(xa,"$1"):a||r)}),e}),ka=La;function Ea(t,e){for(var r=-1,a=t==null?0:t.length,s=Array(a);++r<a;)s[r]=e(t[r],r,t);return s}var Ra=Ea,Q=j,Ma=Ra,Fa=D,Ha=P,za=1/0,tt=Q?Q.prototype:void 0,et=tt?tt.toString:void 0;function rt(t){if(typeof t=="string")return t;if(Fa(t))return Ma(t,rt)+"";if(Ha(t))return et?et.call(t):"";var e=t+"";return e=="0"&&1/t==-za?"-0":e}var Ga=rt,Ka=Ga;function Ua(t){return t==null?"":Ka(t)}var Wa=Ua,Ja=D,qa=Ye,Ba=ka,Xa=Wa;function Za(t,e){return Ja(t)?t:qa(t,e)?[t]:Ba(Xa(t))}var Ya=Za,Qa=9007199254740991,ts=/^(?:0|[1-9]\d*)$/;function es(t,e){var r=typeof t;return e=e==null?Qa:e,!!e&&(r=="number"||r!="symbol"&&ts.test(t))&&t>-1&&t%1==0&&t<e}var rs=es,as=P,ss=1/0;function ns(t){if(typeof t=="string"||as(t))return t;var e=t+"";return e=="0"&&1/t==-ss?"-0":e}var is=ns,os=Me,us=Ya,cs=rs,at=S,ls=is;function hs(t,e,r,a){if(!at(t))return t;e=us(e,t);for(var s=-1,n=e.length,o=n-1,i=t;i!=null&&++s<n;){var u=ls(e[s]),O=r;if(u==="__proto__"||u==="constructor"||u==="prototype")return t;if(s!=o){var k=i[u];O=a?a(k,u,i):void 0,O===void 0&&(O=at(k)?k:cs(e[s+1])?[]:{})}os(i,u,O),i=i[u]}return t}var ds=hs,fs=ds;function ps(t,e,r){return t==null?t:fs(t,e,r)}var m=ps;const I=t=>t instanceof Date,gs=t=>Object.keys(t).length===0,x=t=>t!=null&&typeof t=="object",vs=(t,...e)=>Object.prototype.hasOwnProperty.call(t,...e),L=t=>x(t)&&gs(t),ms=()=>Object.create(null),st=(t,e)=>t===e?{}:!x(t)||!x(e)?e:I(t)||I(e)?t.valueOf()==e.valueOf()?{}:e:Object.keys(e).reduce((r,a)=>{if(vs(t,a)){const s=st(t[a],e[a]);return L(s)&&!I(s)&&(L(t[a])||!L(e[a]))||(r[a]=s),r}return r},ms());function bs(t){return t!==null&&typeof t=="object"&&!(t instanceof Date)}var _s=Array.isArray;function nt(t,e,r,a){return Object.keys(t).forEach(function(s){var n=s.replace(/\./g,"\\.");if(bs(t[s])&&!_s(t[s])){var o=r&&r+"."+n;a&&e.push(r?o:n),nt(t[s],e,o||n,a)}else{var i=r?r+"."+n:n;e.push(i)}}),e}var ys=function(t,e){return nt(t,[],null,e)};function $s(t){return document.head.querySelector(`meta[name="${t}"]`).getAttribute("content")}function ws(t,e,r){if(r>=t.length)for(var a=r-t.length+1;a--;)t.push(void 0);return t.splice(r,0,t.splice(e,1)[0]),t}class it extends l{connect(){this.getNewWidget()}moveItemUp(e){const r=e.currentTarget;this.moveItemToPosition(r,-1)}moveItemDown(e){const r=e.currentTarget;this.moveItemToPosition(r,1)}moveItemToPosition(e,r){const a=parseInt(e.dataset.itemIndex),s=e.dataset.targetList,n=this.dataValue[s].repeated_items,o=ws(n,a,a+r),i=Object.assign({},this.dataValue);i[s].repeated_items=o,this.dataValue=i}removeItem(e){const r=e.currentTarget,a=r.dataset.itemIndex,s=r.dataset.targetList,n=Object.assign({},this.dataValue);n[s].repeated_items.splice(a,1),this.dataValue=n,this.getNewWidget()}addItem(e){const a=e.currentTarget.dataset.targetList;typeof this.dataValue[a]=="undefined"&&(this.dataValue=Object.assign({},this.dataValue,{[a]:{repeated_items:[]}})),this.dataValue=Object.assign({},this.dataValue,{[a]:{repeated_items:[...this.dataValue[a].repeated_items,{}]}}),this.getNewWidget()}dataValueChanged(e,r){const a=st(e,r),s=ys(a);(a.items&&a.items.repeated_items&&JSON.stringify(Object.values(a.items.repeated_items)[0])===JSON.stringify({})||s.filter(o=>o.match(/^id$|\.id$/g)).length>0)&&this.getNewWidget()}updateField(e){const r=e.currentTarget.name,a=m(this.dataValue,r,e.currentTarget.value);this.dataValue=a}updateWysiwygField(e){const r=e.currentTarget.dataset.fieldName,a=m(this.dataValue,r,e.currentTarget.innerHTML);this.dataValue=a}selectResult(e){const r=e.currentTarget,a=JSON.parse(r.dataset.returnObject),s=m(this.dataValue,r.dataset.fieldName,a.id);this.dataValue=s,this.getNewWidget()}removeResource(e){const r=e.currentTarget,a=m(this.dataValue,r.dataset.fieldName,null);this.dataValue=a,this.getNewWidget()}receiveModalReturn(e){const r=e,a=m(this.dataValue,r.return_payload.field_name,r.payload.id);this.dataValue=a,this.getNewWidget()}getNewWidget(){fetch(`${this.setupValue.src}.json`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":$s("csrf-token")},body:JSON.stringify({widget_id:this.widgetIdValue,data:this.dataValue,setup:this.setupValue,max_items:this.maxItemsValue})}).then(e=>e.json()).then(e=>{this.element.innerHTML=e.html_data})}}it.values={widgetId:String,setup:Object,data:Object,maxItems:{type:Number,default:0}};class ot extends l{connect(){}toggleItem(e){Array.from(this.element.classList).includes(this.expandedClass)?this.element.classList.remove(this.expandedClass):this.element.classList.add(this.expandedClass)}}ot.classes=["expanded"];function ut(t,e=[],r={},a=""){const s=document.createElement(t);s.classList.add(...e);for(const n in r)s.setAttribute(n,r[n]);return typeof a=="string"&&(s.innerText=a),s}class w extends l{connect(){this._loadDefaultResults()}showForm(){this.element.classList.add(this.activeListClass)}cancel(e){e.preventDefault(),this.element.classList.remove(this.activeListClass)}errorValueChanged(){this.errorValue==""?this.element.classList.remove(this.fetchErrorClass):this.element.classList.add(this.fetchErrorClass)}resultActiveValueChanged(){if(this.resultTargets.forEach(e=>{e.classList.remove(this.activeResultClass)}),!isNaN(this.resultActiveValue)){const e=this.resultActiveValue;this.resultTargets[e].classList.add(this.activeResultClass)}}mouseOver(e){const r=e.currentTarget;this.resultActiveValue=parseInt(r.dataset.index)}mouseOut(e){this.resultActiveValue=null}resultsValueChanged(){const e=this.fieldNameValue;this.resultTargets.forEach(r=>r.remove()),this.resultActiveValue=null,this.resultsValue.forEach((r,a)=>{const s=Object.assign({receive_index:this.inputTarget.dataset.itemIndex},r),n=ut("li",["kubik-wysiwyg-component--item-autocomplete-results-list-item"],{"data-kubik-autocomplete-target":"result","data-index":a,"data-return-id":s.id,"data-return-object":JSON.stringify(s),"data-field-name":e,"data-action":"mouseout->kubik-autocomplete#mouseOut mouseover->kubik-autocomplete#mouseOver mousedown->kubik-widget#selectResult mousedown->kubik-autocomplete#blur"},r.return_object.display_name);this.resultsListTarget.insertBefore(n,this.feedbackTarget)}),this.resultActiveValue>this.resultsValue.length&&(this.resultActiveValue=this.resultsValue.length-1)}load(){this._fetchResults()}focus(){this.element.classList.add(this.activeClass)}blur(){this.errorValue="",this.inputTarget.blur(),this.connectionController.abort(),this.element.classList.remove(this.fetchErrorClass),this.element.classList.remove(this.loadingClass),this.element.classList.remove(this.activeClass)}_sourceURL(){const e=[window.location.protocol,window.location.host].join("//"),r=new URLSearchParams({kubik_search:"1",q:this.inputTarget.value});return new URL([this.srcValue,".json?",r.toString()].join(""),e)}_loadDefaultResults(){this._fetchResults()}keyCheck(e){switch(e.key){case"Down":case"ArrowDown":this._nextResult(),e.preventDefault(),e.stopImmediatePropagation();return;case"Up":case"ArrowUp":this._previousResult(),e.preventDefault(),e.stopImmediatePropagation();return;case"Enter":const r=this.resultTargets[this.resultActiveValue];r&&r.dispatchEvent(new Event("mousedown")),e.preventDefault(),e.stopImmediatePropagation();return;case"Backspace":e.stopImmediatePropagation();return}}_previousResult(){isNaN(this.resultActiveValue)?this.resultActiveValue=this.resultTargets.length>1?this.resultTargets.length-1:0:this.resultActiveValue=this.resultActiveValue==0?this.resultTargets.length-1:this.resultActiveValue-1}_nextResult(){isNaN(this.resultActiveValue)?this.resultActiveValue=0:this.resultActiveValue=this.resultActiveValue+1==this.resultTargets.length?0:this.resultActiveValue+1}_fetchResults(){this.errorValue="",this.feedbackTarget.innerHTML="Loading...",this.connectionController=new AbortController,fetch(this._sourceURL(),{headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{this.errorValue="",e.length>0&&(this.resultsValue=e,this.queryValue=this.inputTarget.value),this.inputTarget.value==""?(this.queryValue="",this.feedbackTarget.innerHTML="",this.feedbackTarget.insertAdjacentHTML("beforeend",`Showing latest <span>${e.length}</span> results`)):(this.feedbackTarget.innerHTML="",this.queryValue==""?this.feedbackTarget.insertAdjacentHTML("beforeend",`Showing latest <span>${e.length}</span> results`):this.feedbackTarget.insertAdjacentHTML("beforeend",`Showing results for <span>${this.queryValue}</span>`)),this.queryValue==this.inputTarget.value?this.element.classList.remove(this.noResultsClass):this.element.classList.add(this.noResultsClass)}).catch(e=>{this.feedbackTarget.innerHTML="",this.errorValue="Error loading the results"})}}w.classes=["fetchError","loading","active","activeResult","noResults","activeList"],w.targets=["feedback","input","resultsList","result"],w.values={returnController:String,src:String,fieldName:String,query:{type:String,default:""},error:{type:String,default:""},results:{type:Array,default:[]},resultActive:Number};const Os=function(e={},r){let a={"data-controller":"kubik-widget","data-kubik-widget-setup-value":JSON.stringify(e.setup),"data-kubik-widget-data-value":JSON.stringify(r),"data-kubik-widget-widget-id-value":e.setup.widget_id,id:e.setup.widget_id};return e.items_limit&&(a["data-kubik-widget-items-max-items-value"]=e.items_limit),ut("div",["kubik_media_wrapper","kubik-wysiwyg-component"],a)};class Ts{static get defaultWidgetConfig(){return{data_src:"/admin/kubik_wysiwyg_widget/show"}}constructor({data:e,api:r}){this.data=e,this.api=r,this.randomString=Math.random().toString(36).substring(2,7),this.label=this.constructor.toolbox.title;const a=this.constructor.defaultWidgetConfig,s=this.constructor.widgetConfig;this.config=Object.assign(a,s)}render(){const e=[this.config.widget_name,this.randomString].join("-");return Os({setup:{label:this.label,widget_model:this.config.widget_model,src:this.config.data_src,widget_id:e,widget_type:this.config.widget_name,config:this.config}},this.data)}save(e){const r=JSON.parse(e.attributes["data-kubik-widget-data-value"].value);let a={};return this.config.tabs.forEach(s=>{a[s.name]=r[s.name]}),a}validate(e){return!0}}var Cs={KubikWidgetController:it,KubikRepeaterController:ot,PluginFactory:Ts,KubikAutocompleteController:w};return Cs});
